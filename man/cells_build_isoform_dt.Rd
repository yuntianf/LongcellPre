% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/splice_site_correct.R
\name{cells_build_isoform_dt}
\alias{cells_build_isoform_dt}
\title{cells_build_isoform_dt
Build isoform strings per (row) with exact site-pairing semantics (fast, data.table)}
\usage{
cells_build_isoform_dt(data, sites = NULL, flank = 5L, sep = ",", split = "|")
}
\arguments{
\item{data}{A \code{data.frame} or \code{data.table} with columns:
\code{start}, \code{end}, and (when \code{sites} is not \code{NULL}) \code{mid}.}

\item{sites}{\code{NULL} or a vector of splice-site coordinates (numeric or
coercible to numeric) whose length must match the number of entries parsed
from each \code{mid}.}

\item{flank}{Integer; number of bases to extend when filling \code{start == -1}
and/or \code{end == -1}. Default \code{5}.}

\item{sep}{String used between endpoints within a pair (default \code{","}).}

\item{split}{String used between consecutive pairs (default \code{"|"}).}
}
\value{
The input as a \code{data.table} with an added \code{isoform} column.
  Assignment is done by reference when possible; the function returns
  \code{dt[]} for convenience.
}
\description{
Adds an `isoform` column to a table of `{start, end, mid}` using splice-site
structure when available. The implementation matches the original
`site_recover()` semantics while avoiding `apply(..., 1, ...)` and repeated
parsing for speed.
}
\details{
Behavior by case:
\itemize{
  \item If \code{sites} is \code{NULL}, each row's isoform is simply
        \code{"start,end"} (after trimming spaces).
  \item If \code{sites} is provided, \code{mid} is parsed as
        \code{as.logical(as.numeric(strsplit(mid, \",\")))}, so
        \code{0 -> FALSE}, non-zero \code{-> TRUE}, and \code{NA -> NA}.
        For \strong{boundary filling}, indices with non-NA \code{mid} are used
        as a mask: if \code{start == -1}, set \code{start = min(sites[mask]) - flank};
        if \code{end == -1}, set \code{end = max(sites[mask]) + flank}.
        If \code{start} is \code{NA} in this mode, the result is \code{NA}.
        For \strong{interior selection}, \code{NA} entries in \code{mid} are set to
        \code{FALSE} and only \code{TRUE} positions are kept: the sequence
        \code{c(start, sites[TRUE], end)} is then paired \emph{in chunks of two}
        (i.e., \code{(1,2)}, \code{(3,4)}, \code{(5,6)}, ...) to form
        \code{"a,b|c,d|..."} using \code{sep} between numbers and \code{split}
        between pairs. A length mismatch between parsed \code{mid} and
        \code{sites} raises an error.
}
}
