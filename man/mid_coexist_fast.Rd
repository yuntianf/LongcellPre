% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/splice_site_correct.R
\name{mid_coexist_fast}
\alias{mid_coexist_fast}
\title{mid_coexist_fast
Collapse per-(cell, cluster) mids into a consensus and coexistence map (fast)}
\usage{
mid_coexist_fast(data)
}
\arguments{
\item{data}{data.frame or data.table with at least these columns:
\itemize{
  \item \code{cell}: cell/barcode identifier
  \item \code{cluster}: cluster/partition label for the cell
  \item \code{mid}: clone/lineage identifier
}}
}
\value{
A list of two \code{data.table}s:
\describe{
  \item{\code{concensus}}{Columns: \code{cell}, \code{cluster}, \code{concensus} (the mode mid).}
  \item{\code{coexist}}{Columns: \code{from}, \code{to}, \code{count}; aggregated counts of
        mappings after the collapse/mapping rules above.}
}
}
\description{
Given per-cell assignments of clone/lineage IDs (`mid`) within clusters, this
computes (1) a **consensus mid** for each `(cell, cluster)` and
(2) an aggregated **coexistence map** counting how often a source mid
maps to a (possibly collapsed) target mid. Ties are broken by within-group
count, then by global mid size.
}
\details{
This function follows a two-step strategy per \code{(cell, cluster)}:

\enumerate{
  \item Compute counts per \code{mid}; rank mids by descending count, then by
        a global \emph{mid size} (from \code{mid_len()}); take the top 1â€“2.
  \item If two mids are present and exactly one is a parent of the other
        (according to \code{mid_group()} edges \code{c -> p}), collapse both to
        the dominant direction's \emph{mode mid}; otherwise, map each observed
        mid to the group's top-1 \emph{mode mid}.
}

Expectations for helpers:
\itemize{
  \item \code{mid_len(total)} returns a two-column object with columns
        \code{mid}, \code{size}.
  \item \code{mid_group(total)} returns a two-column object with columns
        \code{c} (child), \code{p} (parent). It may be empty; in that case,
        no directed collapsing occurs.
}

Notes:
\itemize{
  \item If a \code{mid} has \code{size = NA}, it is treated as \code{-Inf} for ordering.
  \item The consensus column is named \code{concensus} (intentional spelling to
        match downstream code).
}
}
\examples{
\dontrun{
# data: data.frame/data.table with columns cell, cluster, mid
res <- mid_coexist_fast(data)
concensus_dt <- res[[1]]
coexist_dt   <- res[[2]]
}

}
